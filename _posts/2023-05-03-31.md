---
layout: single
title:  "[리눅스] 셀 스크립트 프로그래밍"
categories: "리눅스"
tag: [blog, jekyll, Linux, 리눅스, 우분투, ubuntu]
---
<br><br>

># 셀 스크립트 프로그래밍

<br>

>학습 순서
>![](/images/linux/25.png){: .align-center}

<br>

***셀(shell)이란?***

- 운영체제를 둘러싸고 입력받는 명령어를 실행시키는 명령어 해석기다.
- 사용자가 입력한 명령을 해석해 커널에게 전달하고 커널의 처리결과를 사용자에게 전달
- 프로그래밍 언어로서의 특성을 가지고 있다.
- 리눅스의 기본 셀은 Bash(Bourne Again Shell) Shell이다.

<br><br>

## 셀의 종류

<br>

상호 연결성, 명령어 라인 편집, 완료, 재실행을 지원하는데 매우 탁월한 성능을 나타냄

<br>

Bourne Shell
- BourneShell, /bin/sh
- korn Shell, /bin/ksh
- Bash, /bin/bash
- Z Shell, /bin/zsh

<br>

C Shell
- C Shell, /bin/csh
- TC Shell, /bin/tcsh

<br>

본 셀(Bourne Shell)
- 최초의 셀
- 단순하고 처리 소도가 빨라서 많이 사용되었고, 지금도 시스템 관리 작업을 수행하는 많은 셀 스크립트는 본 셀을 기반으로 함
- ls -l /bin/sh로 경로 확인하고
- dpkg-reconfigure dash로 bash로 변경

<br>

C 셀(C Shell)
- 본 셀에는 없던 에일리어스나 히스토리 같은 사용자의 편의 기능을 포함
- C언어와 형식이 비슷해 C셀이라 한다

<br>

콘 셀(Korn Shell)
- C 셀과 달리 본 셀과의 호환성을 유지하고 히스토리, 에일리어스 기능 등 C 셀의 특징도 모두 제공하면서 처리 속도도 빠르다.

<br>

베시 셀(Bash Shell)
- 본 셀을 기반으로 개발된 셀
- 본 셀과의 호환성을 유지하며 C셀, 콘 셀의 편리한 기능도 포함

<br><br>

># 1. 셀 기본 사용

<br>

## 셀의 활용과 기능

셀의 확인과 변경
- 셀들은 /etc/shells파일에 그 경로가 설정
- 사용자 정보는 /etc/passwd 파일에 저장
- ***사용자정보의 마지막 필드에 사용자가 사용하는 셀이 설정***

>![](/images/linux/26.png){: .align-center}

<br>

셸의 기능
- 셸은 키보드와 화면을 통해서 사용자와 대화하는 인터페이스 기능을 제공
- ***강력한 프로그래밍 언어 기능을 지원***
- 사용자의 작업 환경을 사용자의 요구사항에 맞추어 설정할 수 있는 기능 제공
- 개인이나 그룹의 스타일이 반영되는 환경을 조성할 수 있다.

<br>

셸의 다양한 기능
- 명령 완성 기능(Tab 키를 누르게 되면, 나머지 부분이 완성되어 생성)

<br>

***방향키로 히스토리 사용하기***
- 지금까지 사용했던 명령어를 보려면 history 명령을 사용
- 위 아래 방향키로 사용
- ***~/.(히든파일)bash_history 파일에 저장되어 있다.***
- ***~/.bashrc(runcomend) 파일의 HISTSIZE 변수로 설정할 수 있다.***

<br>

etc
- 마우스를 사용한 텍스트 복사
- 와일드 캐릭터 지원 - ?(한 문자), *(임의의 문자)

<br>

기본 셀 바꾸기
- chsh [옵션] [사용자명]
- 옵션 : -s shell(지정하는 셀로 로그인셀을 변경_절대경로)
- 옵션 : -l(/etc/shells 파일에 지정된 셀을 출력)
- 사용 예

>![](/images/linux/27.png){: .align-center}

<br>

로그인 셀과 서브 셀

- 로그인 셀 : 사용자가 로그인한 직후 자동 생성되는 셀
- 서브 셀 : 사용자가 직접 실행한 셀
- 서브 셀 종료 명령 : ^d(Ctrl+d), exit
- 서브 셀이 종료되면 이전 셀 환경으로 복귀
- 로그인 셀에서 로그아웃하면 접속 해제

<br>

***현재 사용중인 셀 확인***

- 우선 echo $SHELL 하면 현재 셀 상태를 보여준다.
- cat /etc/passwd (Shift+ \ ) grep user1은 user1의 현재 상태를 보여줌
- chsh -s /bin/sh user1 하면 shell을 변경할 수 있다.
- 이 후 cat /etc/passwd (Shift+ \ ) grep user1하면 변경됨을 확인가능

<br><br>

## 셀 내장 명령어

셀은 자체적으로 내장 명령을 가지고 있다.
- 내장 명령은 별도의 실행 파일이 없고 셀안에 포함한다
- 일반 명령(실행파일)의 경우 /usr/bin/bc
- 실행 명령은 바이너리 파일이므로 cat으로 확인이 불가능하다

<br><br>


***bash 셀의 출력 명령***

***

echo [-n] [문자열]
- 화면에 한 줄의 문자열을 출력한다.
- 옵션 -n은 마지막에 출 바꿈을 하지 않는다.

<br>

printf 형식 [인수...]
- 자료를 형식화하여 화면에 출력한다.
- %d(10진 정수), \n(줄바꿈) 등 C 언어의 printf 함수 형식을 지정한다.

>![](/images/linux/28.png){: .align-center}

<br><br>


### 특수 문자 사용하기
****
명령을 입력하면 셀을 먼저 특수 문자가 있는지 확인하고 이를 적절한 형태로 변경한 후 명령을 실행

<br>

*(별표 - 에스트리크) : 임의의 문자열을 나타내는 특수문자

>![](/images/linux/29.png){: .align-center}

<br>

?와 [ ] : 하나의 문자를 나타내는데 사용
- ?는 길이가 1인 임의의 한 문자, [ ]는 괄호 안에 포함된 문자 중 하나를 나타냄

>![](/images/linux/30.png){: .align-center}

<br>

~과 - : 물결은 사용자의 홈디렉토리, -는 cd명령으로 디렉토리를 이전하기(직전 작업 디렉토리 표시)

>![](/images/linux/31.png){: .align-center}

<br>

;과 (shift+ \ )(파이프) : 명령과 명령을 연결
- ;은 명령을 왼쪽부터 차례로 실행, (shift+ \ )는 왼쪽 명령의 실행결과를 오른쪽 명령의 입력으로 전달

>![](/images/linux/32.png){: .align-center}

<br>

' '와 " " : 문자를 감싸서 문자열로 만들어주고, 문자열 안에 사용된 특수문자의 기능을 없앰
- ''은 모든 특수문자를, ""은 ``, \를 제외한 모든 특수문자를 일반문자로 간주

>![](/images/linux/33.png){: .align-center}

<br>

``(틸트) : 셀은  틸트로 감싸인 문자열을 명령으로 해석해 명령의 실행결과로 전환
- "today is 틸트date틸트"

>![](/images/linux/34.png){: .align-center}

<br>

\ : 백슬래쉬는 특수문자 바로 앞에 사용, 해당 특수문자의 효과를 없애고 일반 문자로 처리
  
>![](/images/linux/35.png){: .align-center}

<br>

특수문자 >, <, >> : 입출력의 방향을 바꾸는 특수문자
- 꺽쇠가 두개면 -append(추가)

>![](/images/linux/36.png){: .align-center}

<br><br>

### 입출력 방향 바꾸기
***

***표준 입출력 장치***
- 표준 입력 장치: 셸이 정보를 받아들이는 장치 ->  키보드
- 표준 출력 장치: 실행 결과를 내보내는 장치 -> 모니터
- 표준 오류 장치: 오류 메시지를 내보내는 장치 -> 모니터

<br>

파일 디스크립터
- 파일 관리를 위해 붙이는 일련 번호
- 표준 입출력 장치를 파일로 바꾸는 것을 ‘리다이렉션(redirection)’ 이라고 함

<br>

출력 리디렉션

- &gt; : 기존 파일의 내용을 삭제하고 새로 결과를 저장

- &gt;&gt; : 기존 파일의 내용뒤에 결과를 추가

<br>

파일 겹쳐쓰기 명령 > 파일이름
- ex. ls -la > out1 으로 파일에 명령어 저장
- set -o noclobber 하고
- ls > out1 하면 이미 있는 파일이라 겹쳐쓰기를 방지해준다.
- 해제하려면 set +o noclobber

<br>

cat 명령으로 파일 생성하기
- cat > out1 입력 후 키보드로 데이터 입력하고 ctrl+D하면
- cat out1하면 입력한 데이터가 보인다.

<br>

파일에 내용 추가하기 : >>
- cat out1 하면 기존 데이터 보임
- date >> out1 하면 기존 데이터 밑에 date가 추가된다.

<br>

오류 리디렉션
- 표준 오류도 기본적으로 화면에 출력되면 표준 출력처럼 디리렉션 가능
- ls에 out1밖에 없는데 ls /abc라고 치면 오류가 뜬다.

>![](/images/linux/37.png){: .align-center}

<br>

명령어 2>
- 명령 2> 파일이름
- 표준 오류 메시지를 파일에 저장한다.
- ex. ls /abc 2> ls.err 하면
- 에러 표시가 나타나지 않고 ls.err에 에러메시지가 저장된다.
- cat ls.err하면 그런파일이나 디렉토리가 없다고 에러메시지가 뜬다.

<br>

Ex. ls . /abc > ls1.out 2> ls1.err 명령어를 해석해보자
- ls1.out은 정상출력, ls1.err은 오류메시지로 저장

<br>

오류 메시지 버리기
- ls /abc 2> /dev/null 하면
- /dev/null(장치파일)이라 휴지통에 버리는 것이다.

표준 출력과 표준 오류를 한 파일로 리디렉션

>![](/images/linux/38.png){: .align-center}

<br>

입력

명령어 <
- 명령 0< 파일 이름
- 명령 < 파일 이름
- 표준 입력을 바꾼다.

>![](/images/linux/39.png){: .align-center}

<br><br>

># 2. 변수 사용과 에일리어스, 히스토리


## 셀 변수와 환경변수

셀 변수 : 지역변수 소문자
환경변수 : 전역변수 대문자

>![](/images/linux/40.png){: .align-center .image-width-half}

<br>

전체 변수 출력 : set, env

>![](/images/linux/41.png){: .align-center .image-width-half}

<br>

>![](/images/linux/42.png){: .align-center .image-width-half}

<br>

주요 환경변수

- HISTSIZE : 히스토리 저장 크기
- HOME : 사용자 홈 디렉토리의 절대 경로
- LANG : 사용하는 언어
- LOGNAME : 사용자 계정 이름
- PATH : 명령을 탐색할 경로
- PWD : 작업 디렉토리 절대 경로
- SHELL : 로그인 셀

<br>

특정 변수 출력하기 : echo
- 변수의 값을 출력할 때는 변수 이름 앞에 특수 문자 $을 붙임
- ex. echo $SHELL : /bin/bash

<br>

셀 변수 설정하기
- 변수이름 = 문자열
- Ex. SOME = test
- echo SOME 하면 SOME
- echo $SOME 하면 test가 출력

<br>

환경변수 설정하기 : export
- 지정한 셀 변수를 환경변수로 변경한다.
- export [-n] [셀변수]
- -n은 환경변수를 셀 변수로 바꾼다.
- -n으로 지정하면 env에서 보이지 않는다.

<br>

변수 해제하기 : unset
- 지정한 변수를 해제한다.
- unset 변수

먼저 셀 변수를 정의하고, export 명령을 사용해 이를 환경변수로 변경한다.

>![](/images/linux/43.png){: .align-center .image-width-half}

<br>



<br>

**에일리어스**
- 긴 명령 대신 짧은 명령을 만들어 사용가능하다.
- 여러 명령을 연결해 하나의 명령으로 만들 수 이있음

alias
- 에일리어스를 생성한다.
- alias 이름 = 명령
- alias만 치면 현재 설정되어있는 에일리어스가 출력된다.
- 다음은 alias 사용 예시다. 중요!!

>![](/images/linux/44.png){: .align-center .image-width-half}
>![](/images/linux/45.png){: .align-center .image-width-half}
>![](/images/linux/46.png){: .align-center .image-width-half}

<br>

에일리어스에 인자 전달하기
- 배시 셀에서는 에일리어스로 인자를 전달할 수 없음
- 배시 셀에서 인자를 전달하려면 프로그래밍 기능에서 함수를 사용

>![](/images/linux/47.png){: .align-center .image-width-half}

<br>

unalias : 에일리어스 해제하기
- alias 명령으로 현재 alias를 확인하고
- unalis 별칭 명령으로 alias를 삭제한다.

<br>

***히스토리***
- 사용자가 이전에 입력한 명령을 다시 불러 사용하는 것
- 명령 : histoty

>![](/images/linux/48.png){: .align-center .image-width-half}
>![](/images/linux/49.png){: .align-center .image-width-half}
>![](/images/linux/50.png){: .align-center .image-width-half}

<br>

명령 편집하기와 재실행하기
- 화살표 키로 수정가능

<br>

히스토리 저장하기
- 히스토리는 .bash_history에 히스토리 저장한다.
- more ~/.bash_history로 확인가능

<br><br>




># 3. 사용자 환경 설정


## 프롬프트 설정

프롬프트 설정 변수 : PS1
- 프롬프트를 바꾸는 것은 환경변수 PS1에 새로운 형태의 문자열을 지정하는 것

>![](/images/linux/51.png){: .align-center}

<br>

이스케이프 문자와 프롬프트 설정하기
- \으로 시작하는 특별한 문자가 이스케이프 문자
- \u와 같이 \으로 시작하는 이스케이프 문자는 두 글자가 아니라 한 글자로 처리
- 이스케이프 문자는 화면에 문자 그대로 출력되지 않고 셸이 문자의 의미를 해석하여 실행

프롬프트 변경 예제
- 우분투 디폴트 프롬프트는 단색이다. 프롬프트를 변경해 원하는 모양의 프롬프트를 설정하기

>![](/images/linux/52.png){: .align-center .image-width-half}
>![](/images/linux/53.png){: .align-center .image-width-half}

<br><br>

## 셀 환경 설정

사용자 환경 설정
- 셸 환경 설정 파일은 기본적으로 사용자의 홈 디렉토리 안에 위치
- 새로운 사용자를 등록하면 /etc/skel디렉토리에 기본값으로 저장되어있는 파일들을 사용자의 기본 홈 디렉토리로 복사하여 생성된다.

>![](/images/linux/54.png){: .align-center}

<br>

환경설정 파일
- 사용자가 로그인 할 때마다 자동으로 실행되는 명령을 저장한 것이 환경설정 파일
- 시스템 환경설정 파일과 사용자 환경설정 파일이 있음
- 셀마다 다른 이름의 파일을 사용

<br>

시스템 환경 설정 파일
- 시스템을 사용하는 전체 사용자의 공통 환경을 설정하는 파일
- /etc/profile, /etc/bashrc, /etc/profile/*.sh

<br>

사용자 환경 설정 파일
- 각 사용자의 홈 디렉에 숨김파일로 생성
- 사용자가 내용을 수정하고 관리기능

>![](/images/linux/55.png){: .align-center}

<br>

우분투 환경변수 설정
- /etc/environment : 시스템 단계에서 설정하는 파일로 모든 사용자에게 적용되는 환경설정.
- ~/.profile: 각 사용자마다 개별적인 환경설정 스크립트 파일
- /etc/profile이 /etc/profile.d/ 안의 모든 *.sh 스크립트들을 실행 시킨다.

## 셀의 명령어 처리 방법

우분투 리눅스의 기본 셀은 bash로 배쉬 셀이라 읽으며, 유닉스의 기본 셀인 bourne셀을 기반으로 korn셀과 C셀의 장점을 함쳐 노은 셀이다.

<br>

셀 명령문 형식

>![](/images/linux/56.png){: .align-center}

<br>

bash셀 내장 명령어
- 셀 스크립트는 반복되는 일련의 작업을 셀 스크립트로 만들어 사용, 시스템 관리를 자동화 할 수 있다.

>![](/images/linux/57.png){: .align-center}
>![](/images/linux/58.png){: .align-center}

>![](/images/linux/59.png){: .align-center}

<br>

***셀 환경 변수 및 실습***

>![](/images/linux/60.png){: .align-center}

<br>

- echo $HOSTNAME, $HOME, $LANG등 확인가능


<br><br>

># 4. 셀 스크립트 프로그래밍

***


셀 스크립트는 셀을 통해 사용자가 ***원하는 작업을 한번에 실행시키기 위해 작성하는 프로그래밍 언어*** 

- 셀 스크립트는 명령어들이 나열되어있는 파일이다.
- 셀은 시스템의 강력한 CLI라는 점과 스크립트 언어프리터(통역)라는 점에서 차이가 있다.
- 모든 데몬(백스라운드 프로세스)을 실행하기 위한 명령들이 스크립트 파일이다.

<br><br>

## 셀 스크립트 작성과 실행

작성
- 에디터를 이용해 작성, 저장

>![](/images/linux/61.png){: .align-center}

<br>

실행(sh : shell)

>![](/images/linux/62.png){: .align-center}

<br>

실행권한 부여(주로 위 방법보다 해당 방법을 사용한다)

>![](/images/linux/63.png){: .align-center}

<br>

셀 스크립트 첫 줄에 #! 의미

>![](/images/linux/64.png){: .align-center}

<br><br>

## 셀 변수

변수에 값이 처음 할당되면 자동으로 변수가 생성
- 모든 변수가 문자열(string)로 취급(숫자를 넣어도 문자로 취급)
- 변수 명은 대소문자를 구분(예: $abc, $ABC는 다른 변수)
- 변수에 값을 대입할 때‘ =‘ 좌우 공백이 없어야 한다.

<br><br>

## 셀 스크립트 프로그램 예제

75p부터 정리하자

